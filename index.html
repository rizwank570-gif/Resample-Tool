<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood Resampling Management Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-900">

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-800 tracking-tight">Blood Resampling Manager</h1>
                <p class="text-slate-600 mt-1">Automated messaging for the Feb 17th Health Checkup follow-ups</p>
            </div>
            <div class="bg-blue-100 text-blue-700 px-4 py-2 rounded-full text-sm font-semibold flex items-center gap-2">
                <span class="relative flex h-2 w-2">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-600"></span>
                </span>
                <span id="count">0</span> Contacts Loaded
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Panel: Message Configuration -->
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                        Message Template
                    </h2>
                    <p class="text-xs text-slate-500 mb-3 italic">The tag <span class="text-blue-600 font-bold font-mono">{Name}</span> will automatically be replaced with the person's actual name.</p>
                    
                    <textarea id="messageTemplate" class="w-full h-72 p-4 text-sm border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all bg-slate-50 leading-relaxed">Hi {Name}, 

We sincerely apologize for the inconvenience. 

Regarding your health checkup held on 17th Feb at the office location, some parameters could not be processed from the previous sample. We need to perform a resampling to ensure accurate results.

Please confirm a convenient date and time for the resampling. 

Options:
1. Office Location (Please share date and time slot)
2. Home Collection (Please share your complete address, pincode, and preferred date and time slot)

Thank you for your cooperation.</textarea>
                    
                    <button onclick="saveTemplate()" class="mt-4 w-full bg-slate-800 text-white py-2.5 rounded-lg hover:bg-slate-700 transition-colors text-sm font-medium shadow-sm">
                        Save Changes to Template
                    </button>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="text-sm font-semibold text-slate-700 mb-2 uppercase tracking-wider">Helpful Tips</h2>
                    <ul class="text-xs text-slate-500 space-y-2">
                        <li class="flex gap-2"><span>•</span> Use the Search bar to find employees instantly by name or phone.</li>
                        <li class="flex gap-2"><span>•</span> Clicking "WhatsApp" opens a new tab with the pre-filled message.</li>
                        <li class="flex gap-2"><span>•</span> The "Copy" button lets you paste the personalized message manually into any app.</li>
                    </ul>
                </div>
            </div>

            <!-- Right Panel: Employee List -->
            <div class="lg:col-span-2 space-y-4">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4 bg-white/50 backdrop-blur-sm">
                        <div class="relative w-full">
                            <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Search employee name or mobile..." class="pl-10 pr-4 py-3 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none w-full bg-slate-50">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 absolute left-3 top-3 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto max-h-[650px] custom-scrollbar">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-50 sticky top-0 z-10">
                                <tr>
                                    <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-widest border-b border-slate-200">Employee Details</th>
                                    <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-widest border-b border-slate-200">Mobile</th>
                                    <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-widest text-right border-b border-slate-200">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody" class="divide-y divide-slate-100">
                                <!-- Data will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full text-sm shadow-2xl opacity-0 transition-all duration-300 pointer-events-none z-50 transform translate-y-4">
        Message copied to clipboard!
    </div>

    <script>
        // Full Employee List
        let contacts = [
            {id: 1, name: "V. kalyan kumar", age: 32, gen: "M", mobile: "9666611832"},
            {id: 2, name: "R.D. chakvee", age: 50, gen: "M", mobile: "9652292906"},
            {id: 3, name: "Sri harsha G.", age: 36, gen: "M", mobile: "9989007229"},
            {id: 4, name: "Dinesh kumar awari", age: 36, gen: "M", mobile: "8686234471"},
            {id: 5, name: "Santhosh kumar vangala", age: 37, gen: "M", mobile: "9989030749"},
            {id: 6, name: "Ajay patel", age: 25, gen: "M", mobile: "7999100783"},
            {id: 7, name: "V. pradeep Reddy", age: 34, gen: "M", mobile: "9959472364"},
            {id: 8, name: "Y. Prudhvi", age: 31, gen: "M", mobile: "7993327284"},
            {id: 9, name: "P. Mallikarjuna", age: 40, gen: "M", mobile: "9030700905"},
            {id: 10, name: "Sherikas Rohith Rao", age: 30, gen: "M", mobile: "9494542125"},
            {id: 11, name: "Krishna Kr", age: 25, gen: "M", mobile: "9771732505"},
            {id: 12, name: "Bhavya Ande", age: 32, gen: "F", mobile: "9000298590"},
            {id: 13, name: "Y. Rahul", age: 25, gen: "M", mobile: "9849559576"},
            {id: 14, name: "G. Eshwar", age: 27, gen: "M", mobile: "9666250466"},
            {id: 15, name: "B. Sriharsha", age: 34, gen: "M", mobile: "9491982851"},
            {id: 16, name: "Rahul Khandelwal", age: 24, gen: "M", mobile: "8347299320"},
            {id: 17, name: "Chetan Kushwaha", age: 24, gen: "M", mobile: "9424788675"},
            {id: 18, name: "Zuhaib wami", age: 30, gen: "M", mobile: "7006581506"},
            {id: 19, name: "Shafina Shaik G", age: 23, gen: "F", mobile: "7396426254"},
            {id: 20, name: "Prathyush M", age: 37, gen: "M", mobile: "8978164815"},
            {id: 21, name: "Goyal Bhalle", age: 39, gen: "M", mobile: "8130705588"},
            {id: 22, name: "Gorigipati Harshitha", age: 32, gen: "F", mobile: "8008231848"},
            {id: 23, name: "Jyothi Magi M", age: 29, gen: "F", mobile: "9446121762"},
            {id: 24, name: "V. Gokul KRISHNAN", age: 25, gen: "M", mobile: "8374145220"},
            {id: 25, name: "B. Goutham", age: 36, gen: "M", mobile: "9000439840"},
            {id: 26, name: "K. Praveen", age: 32, gen: "M", mobile: "9032148288"},
            {id: 27, name: "D. Amar", age: 37, gen: "M", mobile: "8015546787"},
            {id: 28, name: "M.V Sudarshan Reddy", age: 34, gen: "M", mobile: "9966423432"},
            {id: 29, name: "Kanika Chaudhari", age: 28, gen: "F", mobile: "7093825512"},
            {id: 30, name: "Pratik Jadhav", age: 26, gen: "M", mobile: "7738622328"},
            {id: 31, name: "Vandamsetty Lokesh", age: 31, gen: "M", mobile: "9030747248"},
            {id: 32, name: "Akhil Veeramalla", age: 33, gen: "M", mobile: "8970510668"},
            {id: 33, name: "Pavan Kumar", age: 31, gen: "M", mobile: "8500582794"},
            {id: 34, name: "Silari Sathish kumar", age: 30, gen: "M", mobile: "9948566177"},
            {id: 35, name: "Sirpuram Santhosh", age: 35, gen: "M", mobile: "9000253137"},
            {id: 36, name: "B. Prema Tealingam", age: 24, gen: "M", mobile: "7702672511"},
            {id: 37, name: "D. Makhalingam", age: 36, gen: "M", mobile: "9676386146"},
            {id: 38, name: "T. Murali mohan Reddy", age: 44, gen: "M", mobile: "9951844384"},
            {id: 39, name: "Soma SHANKAR BANATH", age: 40, gen: "M", mobile: "9951771161"}
        ];

        const tableBody = document.getElementById('tableBody');
        const countEl = document.getElementById('count');
        const templateEl = document.getElementById('messageTemplate');
        const searchInput = document.getElementById('searchInput');

        // Main rendering function - uses the passed data array
        function renderTable(dataToDisplay) {
            tableBody.innerHTML = '';
            countEl.innerText = dataToDisplay.length;

            dataToDisplay.forEach((person) => {
                const row = document.createElement('tr');
                row.className = "hover:bg-blue-50/50 transition-colors group";
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="text-sm font-semibold text-slate-900">${person.name}</div>
                        <div class="text-xs text-slate-500 font-medium">${person.age} Years • ${person.gen === 'M' ? 'Male' : 'Female'}</div>
                    </td>
                    <td class="px-6 py-4 text-sm text-slate-600 font-mono tracking-tight">
                        +91 ${person.mobile}
                    </td>
                    <td class="px-6 py-4 text-right space-x-2 whitespace-nowrap">
                        <button onclick='handleAction("copy", ${JSON.stringify(person).replace(/'/g, "&apos;")})' 
                                class="inline-flex items-center gap-1.5 text-xs bg-slate-100 text-slate-700 px-3.5 py-2 rounded-lg hover:bg-slate-200 font-bold transition-all border border-slate-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                            Copy
                        </button>
                        <button onclick='handleAction("whatsapp", ${JSON.stringify(person).replace(/'/g, "&apos;")})' 
                                class="inline-flex items-center gap-1.5 text-xs bg-green-500 text-white px-3.5 py-2 rounded-lg hover:bg-green-600 font-bold transition-all shadow-md shadow-green-200/50">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 1 1-7.6-14 8.38 8.38 0 0 1 3.8.9L21 3z"></path></svg>
                            WhatsApp
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function filterTable() {
            const query = searchInput.value.toLowerCase();
            const filtered = contacts.filter(p => 
                p.name.toLowerCase().includes(query) || 
                p.mobile.includes(query)
            );
            renderTable(filtered);
        }

        // Unified handler to ensure the correct name is used every time
        function handleAction(action, person) {
            const template = templateEl.value;
            // This replaces {Name} with the actual person name from the row data
            const personalizedMsg = template.replace(/{Name}/g, person.name);

            if (action === "copy") {
                const el = document.createElement('textarea');
                el.value = personalizedMsg;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                showToast(`Message for ${person.name} copied!`);
            } else if (action === "whatsapp") {
                const encodedMsg = encodeURIComponent(personalizedMsg);
                const url = `https://wa.me/91${person.mobile}?text=${encodedMsg}`;
                window.open(url, '_blank');
            }
        }

        function showToast(text) {
            const toast = document.getElementById('toast');
            toast.innerText = text;
            toast.style.opacity = '1';
            toast.style.transform = 'translate(-50%, -20px)';
            
            setTimeout(() => { 
                toast.style.opacity = '0'; 
                toast.style.transform = 'translate(-50%, 0)';
            }, 2500);
        }

        function saveTemplate() {
            localStorage.setItem('resampling_template_v2', templateEl.value);
            showToast("Message template saved!");
        }

        // Initialize on load
        window.onload = () => {
            const saved = localStorage.getItem('resampling_template_v2');
            if (saved) templateEl.value = saved;
            renderTable(contacts);
        };
    </script>
</body>
</html>
